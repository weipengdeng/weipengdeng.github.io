{{ define "main" }}
  <article class="section">
    <h2 style="margin:0 0 0.35rem">{{ .Title }}</h2>
    {{ with .Params.authors }}
      <div class="item__meta">{{ delimit . ", " }}</div>
    {{ end }}
    {{ with .Params.venue }}
      <div class="item__meta">{{ . }}{{ with $.Params.year }} Â· {{ . }}{{ end }}</div>
    {{ end }}
    {{ with .Params.tags }}
      <div class="topic-row" style="margin:0.75rem 0 0.85rem" aria-label="Publication tags">
        {{ range . }}
          {{ partial "topic-badge.html" . }}
        {{ end }}
      </div>
    {{ end }}

    {{ $links := .Params.links }}
    {{ $pdfHref := "" }}
    {{ $pdfDownload := false }}
    {{ with .Resources.GetMatch "*.pdf" }}
      {{ $pdfHref = .RelPermalink }}
      {{ $pdfDownload = true }}
    {{ end }}
    {{ with $links }}
      {{ with .pdf }}
        {{ $candidate := printf "%v" . }}
        {{ if or (hasPrefix $candidate "http://") (hasPrefix $candidate "https://") }}
          {{ $pdfHref = $candidate }}
          {{ $pdfDownload = false }}
        {{ else if hasPrefix $candidate "/" }}
          {{ $pdfHref = $candidate }}
          {{ $pdfDownload = true }}
        {{ else }}
          {{ $res := $.Resources.GetMatch $candidate }}
          {{ if $res }}
            {{ $pdfHref = $res.RelPermalink }}
            {{ $pdfDownload = true }}
          {{ else if not $pdfHref }}
            {{ $pdfHref = $candidate }}
            {{ $pdfDownload = true }}
          {{ end }}
        {{ end }}
      {{ end }}
    {{ end }}

    {{ $hasActions := false }}
    {{ if $pdfHref }}{{ $hasActions = true }}{{ end }}
    {{ with $links }}
      {{ if or .code .project }}{{ $hasActions = true }}{{ end }}
    {{ end }}

    {{ if $hasActions }}
      <div class="pub-actions" style="margin-bottom:1rem">
        {{ if $pdfHref }}
          {{ $pdfIsExternal := or (hasPrefix $pdfHref "http://") (hasPrefix $pdfHref "https://") }}
          <a class="btn" href="{{ $pdfHref }}"{{ if $pdfIsExternal }} target="_blank" rel="noopener"{{ else if $pdfDownload }} download{{ end }}>PDF</a>
        {{ end }}
        {{ with $links }}
          {{ with .code }}<a class="btn" href="{{ . }}" target="_blank" rel="noopener">Code</a>{{ end }}
          {{ with .project }}<a class="btn" href="{{ . }}" target="_blank" rel="noopener">Project</a>{{ end }}
        {{ end }}
      </div>
    {{ end }}

    {{ with .Params.sdgs }}
      <div class="sdg-row" aria-label="SDG alignment">
        {{ range . }}
          {{ partial "sdg-icon.html" . }}
        {{ end }}
      </div>
    {{ end }}

    <div class="prose">{{ .Content }}</div>
  </article>
{{ end }}
