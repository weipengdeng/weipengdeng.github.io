{{ $pubAll := sort (where .Site.RegularPages "Section" "publications") "Date" "desc" }}
{{ $limit := .Site.Params.home.publicationsLimit | default 6 }}
{{ $pubs := first $limit $pubAll }}
{{ $pubPage := .Site.GetPage "section" "publications" }}

<section class="section">
  <div class="section__header">
    <h2 class="section__title">
      <span class="section__icon" aria-hidden="true">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
          <path d="M12 3l2.6 5.6 6.1.7-4.6 4 1.4 6-5.5-3.1-5.5 3.1 1.4-6-4.6-4 6.1-.7L12 3Z" fill="currentColor" opacity="0.92"/>
        </svg>
      </span>
      <span>Selected Publications</span>
    </h2>
    {{ if $pubPage }}<a class="section__more" href="{{ $pubPage.RelPermalink }}">view all Â»</a>{{ end }}
  </div>

  {{ if not (len $pubAll) }}
    <div class="item__meta">Add publication pages under <code>content/publications/</code> or generate them from <code>bibliography/publications.bib</code>.</div>
  {{ else }}
    {{ $tags := slice }}
    {{ range $pubs }}
      {{ range .Params.tags }}
        {{ $tags = $tags | append . }}
      {{ end }}
    {{ end }}
    {{ $tags = $tags | collections.Uniq | sort }}

    {{ if gt (len $tags) 0 }}
      <div class="pub-controls" role="toolbar" aria-label="Publication filters">
        <button class="filter-btn" type="button" data-pub-filter="all" aria-pressed="true">
          <span class="topic-badge" style="--topic-color: var(--primary)">All</span>
        </button>
        {{ range $tags }}
          <button class="filter-btn" type="button" data-pub-filter="{{ . }}" aria-pressed="false">
            {{ partial "topic-badge.html" . }}
          </button>
        {{ end }}
      </div>
    {{ end }}

    <div class="pub-list">
      {{ range $pubs }}
        {{ partial "publication-card.html" . }}
      {{ end }}
    </div>
  {{ end }}
</section>
